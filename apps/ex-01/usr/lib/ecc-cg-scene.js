import{Vec3,Sphere,Box,Plane,ConvexPolyhedron,Trimesh,Heightfield,Shape,World,NaiveBroadphase,Body,Cylinder,Quaternion,Material,ContactMaterial}from"cannon";import*as CANNON from"cannon";export{CANNON};import{Mesh,CubeTexture,CubeTextureLoader,RGBAFormat,PlaneBufferGeometry,MeshPhongMaterial,GridHelper,AxesHelper,Scene,Fog,PerspectiveCamera,WebGLRenderer,PCFSoftShadowMap,AmbientLight,SpotLight,SpotLightHelper,DirectionalLight,OrthographicCamera,PointLight,PointLightHelper,Vector3,MeshBasicMaterial,SphereGeometry,BoxGeometry,PlaneGeometry,CylinderGeometry,Geometry,Face3,Group,LineSegments,Raycaster,Vector2}from"three";import*as THREE from"three";export{THREE};import GLTFLoader from"three-gltf-loader";import OrbitControls from"threejs-orbit-controls";class Loader{constructor(e){this.options=e||{}}loadGLTF(e,t){var s=t||{};return new Promise((t,i)=>{const n=new GLTFLoader;n.crossOrigin="anonymous",n.load(e,e=>{e.scene.traverse(e=>{e instanceof Mesh&&(e.receiveShadow=!0,e.castShadow=!0,s.reflectionCube&&s.reflectionCube instanceof CubeTexture&&(e.material.envMap=s.reflectionCube))}),t(e)},e=>{},t=>{i("Error: The model "+e+" cannot be downloaded!")})})}loadTexture(e,t){var s=t||{};return new Promise((t,i)=>{const n=(new CubeTextureLoader).setPath(e);n.crossOrigin="anonymous";const o=s.urls||["posx.jpg","negx.jpg","posy.jpg","negy.jpg","posz.jpg","negz.jpg"];n.load(o,e=>{e.format=s.format||RGBAFormat,t(e)},e=>{},t=>{i("Error: The texture "+e+" cannot be downloaded!")})})}applyReflection(e,t){var s=[];return new Promise((i,n)=>{e.traverse(e=>{e instanceof Mesh&&t instanceof CubeTexture&&(e.material.envMap=t,s.push(e))}),i(s)})}}var Stats=function(){var e=0,t=document.createElement("div");function s(e){return t.appendChild(e.dom),e}function i(s){for(var i=0;i<t.children.length;i++)t.children[i].style.display=i===s?"block":"none";e=s}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",function(s){s.preventDefault(),i(++e%t.children.length)},!1);var n=(performance||Date).now(),o=n,a=0,r=s(new Stats.Panel("FPS","#0ff","#002")),h=s(new Stats.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=s(new Stats.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:t,addPanel:s,showPanel:i,begin:function(){n=(performance||Date).now()},end:function(){a++;var e=(performance||Date).now();if(h.update(e-n,200),e>=o+1e3&&(r.update(1e3*a/(e-o),100),o=e,a=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){n=this.end()},domElement:t,setMode:i}};Stats.Panel=function(e,t,s){var i=1/0,n=0,o=Math.round,a=o(window.devicePixelRatio||1),r=80*a,h=48*a,c=3*a,l=2*a,d=3*a,p=15*a,g=74*a,m=30*a,u=document.createElement("canvas");u.width=r,u.height=h,u.style.cssText="width:80px;height:48px";var y=u.getContext("2d");return y.font="bold "+9*a+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=s,y.fillRect(0,0,r,h),y.fillStyle=t,y.fillText(e,c,l),y.fillRect(d,p,g,m),y.fillStyle=s,y.globalAlpha=.9,y.fillRect(d,p,g,m),{dom:u,update:function(h,w){i=Math.min(i,h),n=Math.max(n,h),y.fillStyle=s,y.globalAlpha=1,y.fillRect(0,0,r,p),y.fillStyle=t,y.fillText(o(h)+" "+e+" ("+o(i)+"-"+o(n)+")",c,l),y.drawImage(u,d+a,p,g-a,m,d,p,g-a,m),y.fillRect(d+g-a,p,a,m),y.fillStyle=s,y.globalAlpha=.9,y.fillRect(d+g-a,p,a,o((1-h/w)*m))}}},console.log("three.utils v0.2 loaded");var settings={camera:{position:new Vector3(0,10,30),lookAt:new Vector3(0,0,0)},fog:{color:2250120,near:10,far:200},ambiebtLight:{enabled:!0,color:16777215,energy:.5,castShadow:!1},directionalLight:{enabled:!1,color:16777215,energy:1,castShadow:!0,mapSize:2048,shadowBias:2e-5,position:new Vector3(-20,15,5),showHelper:!1},spotLight:{enabled:!1,color:16777215,energy:1,castShadow:!0,mapSize:2048,shadowBias:2e-5,position:new Vector3(-20,15,1),showHelper:!0},pointLight:{enabled:!0,color:16777215,energy:.9,castShadow:!0,distance:100,mapSize:2048,shadowBias:2e-5,position:new Vector3(-20,15,1),showHelper:!0}};class Graphics{constructor(e){this.options=e||{},this.intialize()}intialize(){this.initScene(),this.initCamera(),this.initRenderer(),this.initControls(),this.initStats(),this.initAmbientLight(),this.initPointLight();const e=new Mesh(new PlaneBufferGeometry(2e4,2e4),new MeshPhongMaterial({color:1118481,depthWrite:!1}));e.name="StaticThreePlane",e.rotation.x=-Math.PI/2,this.scene.add(e);const t=new GridHelper(500,500,8947848,2236962);t.material.opacity=.2,t.material.transparent=!0,this.scene.add(t);const s=new AxesHelper(2);s.position.y=.01,this.scene.add(s),window.addEventListener("resize",()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)},!1),this.update()}initScene(){this.scene=new Scene,this.scene.fog=new Fog(this.options.fogColor||settings.fog.color||11387124,settings.fog.near,settings.fog.far),this.scene.background=this.scene.fog.color}initCamera(e){this.camera=new PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.copy(e||settings.camera.position),this.camera.lookAt(settings.camera.lookAt)}initRenderer(){this.renderer=new WebGLRenderer({antialias:!0,alpha:!0}),this.renderer.setClearColor(this.scene.fog.color),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.gammaInput=!0,this.renderer.gammaOutput=!0,this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.soft=!0,this.renderer.shadowMap.type=PCFSoftShadowMap,document.body.appendChild(this.renderer.domElement)}initAmbientLight(e,t){this.ambientLight=new AmbientLight(e||settings.ambiebtLight.color,t||settings.ambiebtLight.energy),this.ambientLight.castShadow=settings.ambiebtLight.castShadow,this.scene.add(this.ambientLight)}initSpotLight(e,t,s){this.spotLight=new SpotLight(e||settings.spotLight.color),this.spotLight.energy=t||settings.spotLight.energy,this.spotLight.position.copy(s||settings.spotLight.position),this.spotLight.castShadow=settings.spotLight.castShadow,this.spotLight.shadow.mapSize.width=settings.spotLight.mapSize,this.spotLight.shadow.mapSize.height=settings.spotLight.mapSize,this.spotLight.shadow.camera.near=1,this.spotLight.shadow.camera.Far=85,this.spotLight.shadow.camera.Fov=110,this.spotLight.distance=130,this.spotLight.shadow.camera.visible=!1,this.spotLight.angle=Math.PI/3,this.spotLight.shadow.bias=settings.pointLight.shadowBias,this.scene.add(this.spotLight);{const e=new SpotLightHelper(this.spotLight);this.scene.add(e)}}initDirectionalLight(e,t,s){this.directionalLight=new DirectionalLight(e||settings.directionalLight.color),this.directionalLight.energy=t||settings.directionalLight.energy,this.directionalLight.position.copy(s||settings.directionalLight.position),this.directionalLight.castShadow=settings.directionalLight.castShadow,this.directionalLight.shadow.mapSize.width=settings.directionalLight.mapSize,this.directionalLight.shadow.mapSize.height=settings.directionalLight.mapSize,this.directionalLight.shadow.camera=new OrthographicCamera(-100,100,100,-100,.5,1e3),this.scene.add(this.directionalLight)}initPointLight(e,t,s,i){this.pointLight=new PointLight(e||settings.pointLight.color,t||settings.pointLight.energy,i||settings.pointLight.distance),this.pointLight.castShadow=settings.pointLight.castShadow,this.pointLight.position.copy(s||settings.pointLight.position),this.pointLight.shadow.mapSize.width=settings.pointLight.mapSize,this.pointLight.shadow.mapSize.height=settings.pointLight.mapSize,this.pointLight.shadow.camera.near=1,this.pointLight.shadow.camera.Far=85,this.pointLight.shadow.camera.Fov=100,this.pointLight.distance=i||settings.pointLight.distance,this.pointLight.shadow.camera.visible=!1,this.pointLight.angle=Math.PI/2,this.pointLight.shadow.bias=settings.pointLight.shadowBias,this.scene.add(this.pointLight);var n=new PointLightHelper(this.pointLight,1);this.scene.add(n)}initControls(){this.options.useControls&&(this.controls=new OrbitControls(this.camera),this.controls.keys={})}initStats(){this.options.useStats&&(this.stats=new Stats,this.stats.showPanel(0),document.body.appendChild(this.stats.dom),this.stats.dom.style.cssText="position:absolute;bottom:0;left:0;cursor:pointer;opacity:0.5;z-index:10000",this.stats2=new Stats,this.stats2.showPanel(1),document.body.appendChild(this.stats2.dom),this.stats2.dom.style.cssText="position:absolute;bottom:0;left:82px;cursor:pointer;opacity:0.5;z-index:10000",this.stats3=new Stats,this.stats3.showPanel(2),document.body.appendChild(this.stats3.dom),this.stats3.dom.style.cssText="position:absolute;bottom:0;left:164px;cursor:pointer;opacity:0.5;z-index:10000")}update(){this.options.useControls&&this.controls.update(),this.options.useStats&&(this.stats.update(),this.stats2.update(),this.stats3.update()),this.renderer.render(this.scene,this.camera)}}console.log("cannon.three.debug v0.1 loaded");class Debugger{constructor(e,t,s){s=s||{},this.scene=e,this.world=t,this.visibled=!0,this._meshes=[],this._material=new MeshBasicMaterial({color:s.color||13421568,wireframe:!0}),this._sphereGeometry=new SphereGeometry(1),this._boxGeometry=new BoxGeometry(1,1,1),this._planeGeometry=new PlaneGeometry(10,10,10,10),this._cylinderGeometry=new CylinderGeometry(1,1,10,10),this.tmpVec0=new Vec3,this.tmpVec1=new Vec3,this.tmpVec2=new Vec3,this.tmpQuat0=new Vec3}update(){for(var e=this.world.bodies,t=this._meshes,s=this.tmpVec0,i=this.tmpQuat0,n=0,o=0;o!==e.length;o++)for(var a=e[o],r=0;r!==a.shapes.length;r++){var h=a.shapes[r];this._updateMesh(n,h),(c=t[n])&&(a.quaternion.vmult(a.shapeOffsets[r],s),a.position.vadd(s,s),a.quaternion.mult(a.shapeOrientations[r],i),c.position.copy(s),c.quaternion.copy(i)),n++}for(o=n;o<t.length;o++){var c;(c=t[o])&&this.scene.remove(c)}return t.length=n,this}_updateMesh(e,t){var s=this._meshes[e];this._typeMatch(s,t)||(s&&this.scene.remove(s),s=this._meshes[e]=this._createMesh(t)),this._scaleMesh(s,t)}_typeMatch(e,t){if(!e)return!1;var s=e.geometry;return s instanceof SphereGeometry&&t instanceof Sphere||s instanceof BoxGeometry&&t instanceof Box||s instanceof PlaneGeometry&&t instanceof Plane||s.id===t.geometryId&&t instanceof ConvexPolyhedron||s.id===t.geometryId&&t instanceof Trimesh||s.id===t.geometryId&&t instanceof Heightfield}_createMesh(e){var t,s=this._material;switch(e.type){case Shape.types.SPHERE:t=new Mesh(this._sphereGeometry,s);break;case Shape.types.BOX:t=new Mesh(this._boxGeometry,s);break;case Shape.types.PLANE:t=new Mesh(this._planeGeometry,s);break;case Shape.types.CONVEXPOLYHEDRON:for(var i=new Geometry,n=0;n<e.vertices.length;n++){var o=e.vertices[n];i.vertices.push(new Vector3(o.x,o.y,o.z))}for(n=0;n<e.faces.length;n++)for(var a=e.faces[n],r=a[0],h=1;h<a.length-1;h++){var c=a[h],l=a[h+1];i.faces.push(new Face3(r,c,l))}i.computeBoundingSphere(),i.computeFaceNormals(),t=new Mesh(i,s),e.geometryId=i.id;break;case Shape.types.TRIMESH:var d=new Geometry,p=this.tmpVec0,g=this.tmpVec1,m=this.tmpVec2;for(n=0;n<e.indices.length/3;n++){e.getTriangleVertices(n,p,g,m),d.vertices.push(new Vector3(p.x,p.y,p.z),new Vector3(g.x,g.y,g.z),new Vector3(m.x,m.y,m.z));h=d.vertices.length-3;d.faces.push(new Face3(h,h+1,h+2))}d.computeBoundingSphere(),d.computeFaceNormals(),t=new Mesh(d,s),e.geometryId=d.id;break;case Shape.types.HEIGHTFIELD:d=new Geometry,p=this.tmpVec0,g=this.tmpVec1,m=this.tmpVec2;for(var u=0;u<e.data.length-1;u++)for(var y=0;y<e.data[u].length-1;y++)for(var w=0;w<2;w++){e.getConvexTrianglePillar(u,y,0===w),p.copy(e.pillarConvex.vertices[0]),g.copy(e.pillarConvex.vertices[1]),m.copy(e.pillarConvex.vertices[2]),p.vadd(e.pillarOffset,p),g.vadd(e.pillarOffset,g),m.vadd(e.pillarOffset,m),d.vertices.push(new Vector3(p.x,p.y,p.z),new Vector3(g.x,g.y,g.z),new Vector3(m.x,m.y,m.z));n=d.vertices.length-3;d.faces.push(new Face3(n,n+1,n+2))}d.computeBoundingSphere(),d.computeFaceNormals(),t=new Mesh(d,s),e.geometryId=d.id}return t&&(t.name="___mesh_debug___"+Math.floor(1e10*Math.random()),this.scene.add(t)),t}_scaleMesh(e,t){switch(t.type){case Shape.types.SPHERE:var s=t.radius;e.scale.set(s,s,s);break;case Shape.types.BOX:e.scale.copy(t.halfExtents),e.scale.multiplyScalar(2);break;case Shape.types.CONVEXPOLYHEDRON:e.scale.set(1,1,1);break;case Shape.types.TRIMESH:e.scale.copy(t.scale);break;case Shape.types.HEIGHTFIELD:e.scale.set(1,1,1)}}setVisible(e){const t=this;this.visibled=!0===e||!1===e?e:this.visibled,this.scene.traverse(e=>{e instanceof Mesh&&e.name.includes("___mesh_debug___")&&(e.visible=t.visibled)})}toggleVisible(){this.visibled=!this.visibled,this.setVisible(this.visibled)}}console.log("cannon.utils v0.1 loaded");class Physics{constructor(e,t){this.options=t||{},this.graphics=e,this.timeStep=t.timeStep||1/60,this.scalingFactor=t.scalingFactor||1,this.debugColor=t.debugColor||16768256,this.debugEnabled=t.debugEnabled||!1,this.debugEnabled||(this.scalingFactor=.98),this.gravity=t.gravity||new Vec3(0,-9.8,0),this.timeNow=Date.now(),this.timePrv=Date.now(),this.initPhysics()}initPhysics(){this.world=new World,this.world.gravity=this.gravity,this.world.broadphase=new NaiveBroadphase,this.world.solver.iterations=10,this.world.quatNormalizeFast=!1,this.world.quatNormalizeSkip=0,this.debugRenderer=new Debugger(this.graphics.scene,this.world,{color:this.debugColor})}update(){this.world.step(this.timeStep),this.world.bodies.forEach(e=>{null!=e.threemesh&&(e.threemesh.position.copy(e.position),e.threemesh.quaternion.copy(e.quaternion))}),this.debugEnabled&&this.debugRenderer.update()}createPhysicsFromScene(e){const t=this;e.traverse(e=>{e instanceof Group?(t.debug&&console.log("\tMultipleMaterialMesh name: "+e.name," children: "+e.children.length),t.createBodyFromMesh(e)):e instanceof Mesh&&e.parent instanceof Scene&&(t.debug&&console.log("SingleMaterialMesh name: "+e.name),t.createBodyFromMesh(e))})}changeBodyToStatic(e){e.type=Body.STATIC,e.mass=0,e.updateMassProperties(),e.aabbNeedsUpdate=!0}getMass(e){return e.name.toLowerCase().includes("static")?0:(e.scale.x+e.scale.y+e.scale.z)/3}createBodyFromMesh(e){const t=this.getMass(e),s=e.name.toLowerCase();s.includes("cube")||s.includes("box")?this.createBoxBody(e,t):s.includes("sphere")|s.includes("icosphere")?this.createSphereBody(e,t):s.includes("cylinder")?this.createCylinderBody(e,t):s.includes("cone")&&this.createConeBody(e,t)}createBoxBody(e,t){const s=this.scalingFactor,i=new Vec3(e.scale.x*s,e.scale.y*s,e.scale.z*s),n=new Box(i),o=new Body({mass:t});o.addShape(n),o.quaternion.copy(e.quaternion),o.position.copy(e.position),o.threemesh=e,this.world.add(o)}createSphereBody(e,t){const s=this.scalingFactor,i=e.scale.x*s+.03,n=new Sphere(i),o=new Body({mass:t});o.addShape(n),o.quaternion.copy(e.quaternion),o.position.copy(e.position),o.threemesh=e,this.world.add(o)}createCylinderBody(e,t){const s=this.scalingFactor,i=e.scale.x,n=i,o=2*e.scale.y,a=new Cylinder(i*s,n*s,o*s,16);var r=new Quaternion;r.setFromAxisAngle(new Vec3(1,0,0),-Math.PI/2),a.transformAllPoints(new Vec3,r);const h=new Body({mass:t});h.addShape(a),h.quaternion.copy(e.quaternion),h.position.copy(e.position),h.threemesh=e,this.world.add(h)}createConeBody(e,t){const s=this.scalingFactor,i=e.scale.x,n=2*e.scale.y,o=new Cylinder(.001*s,i*s,n*s,16);var a=new Quaternion;a.setFromAxisAngle(new Vec3(1,0,0),-Math.PI/2),o.transformAllPoints(new Vec3,a);const r=new Body({mass:t});r.addShape(o),r.quaternion.copy(e.quaternion),r.position.copy(e.position),r.threemesh=e,this.world.add(r)}}class Clock{constructor(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}class Engine{constructor(e){this.options=e||{},this.callback=null,this.frameCount=0,this.usePhysics=void 0===this.options.usePhysics||this.options.usePhysics,this.graphics=new Graphics({useControls:void 0===this.options.useControls||this.options.useControls,useStats:void 0===this.options.useStats||this.options.useStats,fogColor:void 0!==this.options.fogColor?this.options.fogColor:"#3388ff"}),this.physics=new Physics(this.graphics,{debugEnabled:this.options.useDebug||!1,debugColor:void 0!==this.options.debugColor?this.options.debugColor:16776960,timeStep:void 0!==this.options.timeStep?this.options.timeStep:1/60,gravity:new Vec3(0,-10,0)}),this.clock=new Clock}init(e){var t=e.modelPath,s=e.envPath;return new Promise((e,i)=>{const n=this,o=new Loader;console.group("Engine.init: "),o.loadTexture(s).then(s=>{n.print("Texture loaded!","success"),o.loadGLTF(t).then(t=>{n.print("Model loaded!","success"),o.applyReflection(t.scene,s).then(i=>{n.print(i.length+" meshes is applyed by reflection map","success"),n.print("Add all objects to scene","info"),n.graphics.scene.add(t.scene),n.print("Create rigid bodies of all meshes","info"),n.physics.createPhysicsFromScene(n.graphics.scene),n.print("Engine Resolved","success"),e({graphics:n.graphics,physics:n.physics,scene:t.scene,texture:s}),console.groupEnd()}).catch(e=>{i(e)})}).catch(e=>{i(e)})}).catch(e=>{i(e)})})}update(){window.requestAnimationFrame(()=>this.update()),this.usePhysics&&this.physics.update(),this.graphics.update();var e=this.clock.getDelta();this.frameCount++,this.callback&&this.callback(e,this.frameCount)}start(e){this.callback=e||null,this.update()}setCallback(e){this.callback=e||null}enablePhysics(e){this.isPhysicsEnabled=e}print(e,t){if(t){var s="#000000";switch(t){case"info":s="#112288";break;case"success":s="#118822";break;case"warning":s="#888822";break;case"error":s="#881122";break;default:s="#333333"}console.log("%cEngine: "+e,"color:"+s)}else console.log("Engine: "+e)}getMeshByName(e){var t=[];return this.graphics.scene.traverse(s=>{s.name===e&&(s instanceof Mesh||s instanceof Group)&&t.push(s)}),t.length>1&&console.warning("Engine: Found + "+t.length+" meshes. Only the first mesh is returned"),t[0]}getBodyByMeshName(e){var t=[],s=this.physics.world.bodies;for(let i=0;i<s.length;i++){const n=s[i];n.threemesh.name.toLowerCase()===e.toLowerCase()&&t.push(n)}return t.length>1&&console.warning("TCUtils: Found + "+t.length+" bodies. Only the first body is returned"),t[0]}getMeshesFromScene(){const e=[];return this.graphics.scene.traverse(t=>{t instanceof Mesh&&t.name&&e.push(t)}),e}getMeshesFromWorld(){const e=[];return this.physics.world.bodies.forEach(t=>{t.threemesh.traverse(t=>{t instanceof Mesh&&(t.parent instanceof Group?e.push(t.parent):e.push(t))})}),e}changeBodyToStatic(e){e.type=Body.STATIC,e.mass=0,e.updateMassProperties(),e.aabbNeedsUpdate=!0}debugPrintBodies(){console.group("Current Bodies");var e=physics.world.bodies;for(let t=0;t<e.length;t++){const s=e[t];console.log(s.threemesh.name)}console.groupEnd()}addAxesToMesh(e,t){if(e.children){var s=!1;for(let t=0;t<e.children.length;t++)if(e.children[t]instanceof LineSegments){s=!0;break}if(!s){var i=t;i||(i=(i=e.scale.x>e.scale.y?e.scale.x:e.scale.y)>e.scale.z?i:e.scale.z);var n=new AxesHelper(t||2);e.add(n)}}}removeAxesFromMesh(e){var t=void 0;for(let s=0;s<e.children.length;s++)if(e.children[s]instanceof LineSegments){t=e.children[s];break}t&&e.remove(t)}addAxesHelperToAllMeshes(e){this.graphics.scene.traverse(t=>{t instanceof Mesh&&this.addAxesToMesh(t,e)})}removeAxesHelperFromAllMeshes(){this.graphics.scene.traverse(e=>{e instanceof Mesh&&this.removeAxesFromMesh(e)})}setGravity(e){return this.physics.world.gravity=e,this}on(e,t){return window.addEventListener(e,e=>{e.preventDefault(),e.stopPropagation(),t(e)}),this}createGroundMaterial(e,t){var s=new Material("__physicGroundMaterial"),i=new ContactMaterial(s,s,{friction:null!=e?e:.4,restitution:null!=t?t:0});return this.physics.world.addContactMaterial(i),s}createObjectMaterial(e,t,s){var i=new Material("__physicObjectMaterial"),n=new ContactMaterial(s,i,{friction:null!=e?e:0,restitution:null!=t?t:.9});return this.physics.world.addContactMaterial(n),i}}class RayCast{constructor(e,t){this.graphics=e,this.physics=t,this.callback=null,this.meshes=[],this.raycaster=new Raycaster}doRayCast(e){const t=new Vector2;t.x=+e.clientX/this.graphics.renderer.domElement.clientWidth*2-1,t.y=-e.clientY/this.graphics.renderer.domElement.clientHeight*2+1,this.meshes.length<1&&(this.meshes=this.getMeshesFromScene());var s=[];if(this.meshes.length>1){this.raycaster.setFromCamera(t,this.graphics.camera);let e=this.raycaster.intersectObjects(this.meshes);console.group("RayCast.doRayCast"),console.dir(this.raycaster);for(let t=0;t<e.length;t++){const i=e[t].object;console.dir(e[t]),i.parent instanceof Group?s.push({mesh:i.parent,intersect:e[t],ray:this.raycaster.ray}):s.push({mesh:i,intersect:e[t],ray:this.raycaster.ray})}console.groupEnd()}return s}updateScene(){this.meshes=getMeshesFromScene()}getMeshesFromScene(e){const t=e||this.graphics.scene,s=this.meshes;return t.traverse(e=>{e instanceof Mesh&&e.name&&s.push(e)}),this.meshes}getMeshesFromWorld(e){const t=e||this.physics.world,s=this.meshes;return t.bodies.forEach(e=>{e.threemesh.traverse(e=>{e instanceof Mesh&&e.name&&s.push(e)})}),this.meshes}}class KeyEvent{constructor(e){this.down=!1,this.key=e,this.keyCode=void 0,this.target=void 0,this.shift=!1,this.ctrl=!1,this.alt=!1,this.repeat=!1,this.timeOld=performance.now(),this.timeNew=0,this.timeDif=0,this.timeSum=0}}console.log("%c keyboaed v0.1 is loaded!","color: #008800");class Keyboard{constructor(e,t){this.options=t||{},this.callback=e||null,this.event=new KeyEvent(""),this.keyDownList=[],document.addEventListener("keydown",e=>{var t=!1;for(let s=0;s<this.keyDownList.length;s++)if(this.keyDownList[s].key===e.key){t=!0;break}if(!t){var s=new KeyEvent(e.key);_updateParams(s,e,!0),this.keyDownList.push(s)}this.callback&&(_updateParams(this.event,e,!0),this.callback(this.event))}),document.addEventListener("keyup",e=>{var t=-1;for(let s=0;s<this.keyDownList.length;s++)if(this.keyDownList[s].key===e.key){t=s;break}t>=0&&this.keyDownList.splice(t,1),this.callback&&(_updateParams(this.event,e,!1),this.callback(this.event))})}setCallback(e){this.callback=e}getKeyDown(e,t){for(let i=0;i<this.keyDownList.length;i++){var s=this.keyDownList[i];if(s.key===e)return!t||Number(performance.now()-s.timeNew)<Number(t)}return!1}}function _updateParams(e,t,s){e.down=s,e.key=t.key,e.keyCode=t.keyCode,e.shift=t.shiftKey,e.ctrl=t.ctrlKey,e.alt=t.altKey,e.repeat=t.repeat,e.target=t.target,e.timeOld=e.timeNew,e.timeNew=performance.now(),e.timeDif=s?e.timeNew-e.timeOld:0,e.timeSum=s?e.timeSum+e.timeDif:0}var cgScene={};export default cgScene;export{Engine,RayCast,Graphics,Graphics as Physics,Keyboard};